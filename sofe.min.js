"use strict";var manifest=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.getManifest=getManifest;exports.getAllManifests=getAllManifests;exports.clearManifest=clearManifest;var cachedRemoteManifestPromise={};var cachedManifests={};var hasWindow=typeof window!=="undefined";function getManifest(config){var visitedManifestUrls=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var parent=arguments.length<=2||arguments[2]===undefined?null:arguments[2];if(config.manifestUrl&&cachedRemoteManifestPromise[config.manifestUrl]){return cachedRemoteManifestPromise[config.manifestUrl]}var promise=new Promise(function(resolve,reject){var staticManifest=config.manifest||{};if(config.manifestUrl&&hasWindow){(function(){var xhrLoaded=function xhrLoaded(){if(Number(xhr.status)>=200&&Number(xhr.status)<300){var json=void 0;try{json=JSON.parse(xhr.responseText)}catch(ex){xhrFailed();return}visitedManifestUrls.push(config.manifestUrl);if(json&&json.sofe){if(parent){cachedManifests[config.manifestUrl]={manifest:json.sofe.manifest||{},parent:parent};if(!cachedManifests[parent]){cachedManifests[parent]={manifest:staticManifest,parent:"static"}}}else{cachedManifests.static={manifest:staticManifest,parent:null};if(!cachedManifests[config.manifestUrl]){cachedManifests[config.manifestUrl]={manifest:json.sofe.manifest||{},parent:"static"}}}if(typeof json.sofe.manifestUrl==="string"){if(visitedManifestUrls.indexOf(json.sofe.manifestUrl)>=0){reject(new Error("Cannot load manifest -- circular chain of sofe manifests, '"+json.sofe.manifestUrl+"' detected twice in chain."))}else{getManifest(json.sofe,visitedManifestUrls,config.manifestUrl).then(function(chainedManifest){if(config.manifest===Object(config.manifest)){resolve(_extends({},chainedManifest,config.manifest))}else{resolve(chainedManifest)}}).catch(function(err){reject(err)})}}else if(json.sofe.manifest){if(json.sofe.manifest===Object(json.sofe.manifest)){var cachedRemoteManifest=_extends({},json.sofe.manifest,staticManifest);if(hasWindow){window.sofe.cachedRemoteManifest=cachedRemoteManifest}resolve(cachedRemoteManifest)}else{reject(new Error("Invalid manifest JSON at '"+config.manifestUrl+"': the 'manifest' property must be a plain object"))}}else{reject(new Error("Invalid manifest JSON at '"+config.manifestUrl+"': there must either be a 'sofe.manifest' object or 'sofe.manifestUrl' string"))}}else{reject(new Error("Invalid manifest JSON at '"+config.manifestUrl+"': a manifest must include a sofe attribute"))}}else{xhrFailed()}};var xhrFailed=function xhrFailed(){reject(new Error("Invalid manifest: must be parseable JSON"))};var xhr=new XMLHttpRequest;xhr.addEventListener("load",xhrLoaded);xhr.addEventListener("error",xhrFailed);xhr.open("GET",config.manifestUrl);xhr.send()})()}else{resolve(staticManifest)}});if(config.manifestUrl){cachedRemoteManifestPromise[config.manifestUrl]=promise}return promise}function getAllManifests(config){return new Promise(function(resolve,reject){getManifest(config).then(function(manifest){resolve({flat:_extends({},manifest),all:_extends({},cachedManifests)})}).catch(reject)})}function clearManifest(){cachedRemoteManifestPromise=window.sofe.cachedRemoteManifest={};cachedManifests={}}return module.exports}({exports:{}});var middleware=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.stepMiddleware=stepMiddleware;function stepMiddleware(middleware,load,action){if(middleware.length===0)return action(load,[]);middleware=middleware.map(function(f){return f?f:function(load,next){next(load)}}).map(function toMiddleWareThatAlwaysCallNext(f){if(f.length===1){return function(load,next){f(load);next(load)}}else{return f}});if(middleware.length===1){var _ret=function(){var next=middleware[0](load,function(load){setTimeout(function(){return action(load,[next])})});return{v:void 0}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}var newMiddleware=[];var last=function last(){var _middleware;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var next=(_middleware=middleware)[middleware.length-1].apply(_middleware,args.concat([function(load){setTimeout(function(){return action(load,[].concat(newMiddleware,[next]))})}]))};var rest=middleware.slice(0,-1);var chain=rest.map(function(f,index){return function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}if(index!==rest.length-1){var _next=f.apply(undefined,args.concat([function(load){return setTimeout(function(){return chain[index+1](load)})}]));newMiddleware.push(_next)}else{var _next2=f.apply(undefined,args.concat([last]));newMiddleware.push(_next2)}}});chain[0](load)}return module.exports}({exports:{}});var registries=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getUrlFromRegistry=getUrlFromRegistry;var NPM_CDN="https://npmcdn.com";var hasWindow=typeof window!=="undefined";function getRegistryUrl(config){if(config&&config.registry)return config.registry;else return NPM_CDN}function getUrlFromRegistry(service,config){return new Promise(function(resolve,reject){var requestUrl=getRegistryUrl(config)+"/"+service+"/package.json";if(!hasWindow){return resolve("file://"+__dirname+"/blank.js")}var xhr=new XMLHttpRequest;xhr.addEventListener("load",xhrLoaded);xhr.addEventListener("error",xhrFailed);xhr.open("GET",requestUrl);xhr.send();function xhrLoaded(){if(Number(xhr.status)>=200&&Number(xhr.status)<300){var json=void 0;try{json=JSON.parse(xhr.responseText)}catch(ex){xhrFailed();return}if(json.sofe){resolve(json.sofe.url)}else{var version=json.version;if(json.sofe&&json.sofe.url){resolve(json.sofe.url)}else{resolve(NPM_CDN+"/"+service)}}}else{xhrFailed()}}function xhrFailed(){reject(new Error("Invalid registry response for service: "+service+"\nRequest:"+requestUrl))}})}return module.exports}({exports:{}});var index=function(module){var exports=module.exports;function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)};return module.exports}({exports:{}});var utils=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};exports.getServiceName=getServiceName;exports.resolvePathFromService=resolvePathFromService;var _pathBrowserify=index;function getServiceName(obj){var address=void 0;if(typeof obj==="string"){address=obj}else if((typeof obj==="undefined"?"undefined":_typeof(obj))==="object"&&typeof obj.address==="string"){address=obj.address}else{throw new Error("getServiceName must be called with a string url or with a SystemJS load object that has an address")}var urlParts=getRegex().exec(address);var splits=urlParts[5].split("/");return splits[0]||splits[1]}function resolvePathFromService(services,name,parentName){var parentAddress=getServiceResolution(services,parentName);var urlParts=getRegex().exec(parentAddress);return urlParts[1]+urlParts[3]+(0,_pathBrowserify.join)(urlParts[5],"../",name)}function getServiceResolution(services,name){for(var service in services){if(name.indexOf(service)===0){return services[service]}}}function getRegex(){return/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/g}return module.exports}({exports:{}});var hooks=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetch=undefined;exports.normalize=normalize;exports.isOverride=isOverride;exports.locate=locate;exports.setMiddleWare=setMiddleWare;var _utils=utils;var _registries=registries;var _manifest=manifest;var _middleware=middleware;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var config=System.sofe||{};var systemNormalize=System.normalize;var systemLocate=System.locate;var hasWindow=typeof window!=="undefined";var allMiddleware=[];var serviceMap={};var serviceOverrides=[];var middlewareMap={};var middlewareId=0;var middlewareTracker=0;function normalize(name,parentName,parentAddress){var isSofePlugin=/.+!sofe.*/;name=name.match(isSofePlugin)?normalizeSofePlugin(name):name;if(parentName&&parentName.match(/sofe(@[0-9a-zA-Z\-\.]+)?\.js$/)){if(name.match(isSofePlugin)){return systemNormalize.call(this,name,parentName,parentAddress)}else{if(name&&name[0]==="."){return(0,_utils.resolvePathFromService)(serviceMap,name,parentName)}else{return systemNormalize.call(this,name,parentName,parentAddress)}}}else{return systemNormalize.call(this,name,parentName,parentAddress)}function normalizeSofePlugin(name){return name.slice(0,name.indexOf("!"))+"!sofe"}}function isOverride(service){return service?serviceOverrides.indexOf(service)>-1:!!serviceOverrides.length}function locate(load){var isSofePlugin=/.+!sofe.*/;middlewareId++;var id=middlewareId;return new Promise(function(resolvePromise,reject){(0,_middleware.stepMiddleware)(allMiddleware,load,function(load,newMiddleware){function resolve(url){(0,_middleware.stepMiddleware)(newMiddleware,url,function(newUrl,newMiddleware){middlewareMap[id]=newMiddleware;middlewareTracker=id;resolvePromise(newUrl)})}var service=(0,_utils.getServiceName)(load.address);if(hasWindow&&window.sessionStorage&&window.sessionStorage.getItem("sofe:"+service)){console.log("Using session storage override to resolve sofe service '"+service+"' to url '"+window.sessionStorage.getItem("sofe:"+service)+"'");console.log("Run window.sessionStorage.removeItem('sofe:"+service+"') to remove this override");var url=window.sessionStorage.getItem("sofe:"+service);serviceMap[load.name]=url;addServiceOverride(service);resolve(url)}else if(hasWindow&&window.localStorage&&window.localStorage.getItem("sofe:"+service)){console.log("Using local storage override to resolve sofe service '"+service+"' to url '"+window.localStorage.getItem("sofe:"+service)+"'");console.log("Run window.localStorage.removeItem('sofe:"+service+"') to remove this override");var _url=window.localStorage.getItem("sofe:"+service);serviceMap[load.name]=_url;addServiceOverride(service);resolve(_url)}else{(0,_manifest.getManifest)(config).then(function(manifest){if(manifest&&manifest[service]){serviceMap[load.name]=manifest[service];resolve(manifest[service])}else{(0,_registries.getUrlFromRegistry)(service,config).then(function(url){serviceMap[load.name]=url;resolve(url)}).catch(function(error){reject(error)})}}).catch(function(error){reject(error)})}})})}function setMiddleWare(middleware){allMiddleware=[].concat(_toConsumableArray(allMiddleware),_toConsumableArray(middleware))}function fetch(load,_systemFetch){return new Promise(function(resolve,reject){var middleware=middlewareMap[middlewareTracker]||[];delete middlewareMap[middlewareTracker];var systemFetchAlreadyCalled=false;(0,_middleware.stepMiddleware)(middleware,{systemFetch:function systemFetch(load){systemFetchAlreadyCalled=true;return _systemFetch(load)},load:load},function(load){load=load.load?load.load:load;if(systemFetchAlreadyCalled){resolve(load)}else{resolve(_systemFetch(load))}})})}exports.fetch=fetch;function addServiceOverride(service){if(serviceOverrides.indexOf(service)===-1){serviceOverrides.push(service)}}if(typeof window!=="undefined"){window.sofe={clearCache:function clearCache(){serviceMap={};allMiddleware=[];middlewareMap={};serviceOverrides=[];(0,_manifest.clearManifest)()}}}return module.exports}({exports:{}});var sofe=function(module){var exports=module.exports;"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getServiceName=exports.isOverride=exports.fetch=exports.locate=undefined;exports.getAllManifests=getAllManifests;exports.applyMiddleware=applyMiddleware;var _utils=utils;Object.defineProperty(exports,"getServiceName",{enumerable:true,get:function get(){return _utils.getServiceName}});exports.getManifest=getManifest;var _hooks=hooks;var _manifest=manifest;System.normalize=_hooks.normalize;function getAllManifests(){return(0,_manifest.getAllManifests)(System.sofe||{})}function applyMiddleware(){for(var _len=arguments.length,middleware=Array(_len),_key=0;_key<_len;_key++){middleware[_key]=arguments[_key]}var chain=middleware.map(function(middleware){return middleware()});(0,_hooks.setMiddleWare)(chain)}exports.locate=_hooks.locate;exports.fetch=_hooks.fetch;exports.isOverride=_hooks.isOverride;function getManifest(url){if(typeof url!=="string"){throw new Error("sofe getManifest API must be called with a url string")}return new Promise(function(resolve,reject){(0,_manifest.getManifest)({manifestUrl:url}).then(function(){getAllManifests().then(function(manifests){resolve(manifests.all[url].manifest)}).catch(reject)}).catch(reject)})}return module.exports}({exports:{}});var isOverride=sofe.isOverride;var fetch=sofe.fetch;var locate=sofe.locate;var getManifest=sofe.getManifest;var applyMiddleware=sofe.applyMiddleware;var getAllManifests=sofe.getAllManifests;var getServiceName=sofe.getServiceName;exports["default"]=sofe;exports.isOverride=isOverride;exports.fetch=fetch;exports.locate=locate;exports.getManifest=getManifest;exports.applyMiddleware=applyMiddleware;exports.getAllManifests=getAllManifests;exports.getServiceName=getServiceName;
//# sourceMappingURL=dist/sofe.min.js.map